import asyncio
import edge_tts
import questionary
from rich.console import Console
from rich.panel import Panel
from rich.progress import Progress, SpinnerColumn, TextColumn, BarColumn, TimeRemainingColumn
from rich.markdown import Markdown
from rich.style import Style
from rich.table import Table
from rich.box import SQUARE
from rich.columns import Columns
from typing import Dict

console = Console()

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–≥—Ä–∞–º–º–µ
PROGRAM_NAME = "üéô VoiceForge Pro"
PROGRAM_VERSION = "1.0.0"
PROGRAM_DESCRIPTION = """[bold cyan]VoiceForge Pro[/] - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ä–µ—á–∏

[bold yellow]–û –ø—Ä–æ–≥—Ä–∞–º–º–µ:[/]
–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–π —Ä–µ—á–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–π Microsoft Edge TTS.
–ò–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞—É–¥–∏–æ–∫–Ω–∏–≥, –ø–æ–¥–∫–∞—Å—Ç–æ–≤, –æ–±—É—á–∞—é—â–∏—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏ –º–Ω–æ–≥–æ–≥–æ –¥—Ä—É–≥–æ–≥–æ.

[bold green]üåü –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:[/]
‚Ä¢ –í—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏
‚Ä¢ –î–≤–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –≥–æ–ª–æ—Å–∞
‚Ä¢ –ì–æ—Ç–æ–≤—ã–µ –ø—Ä–µ—Å–µ—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á
‚Ä¢ –¢–æ—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
‚Ä¢ –£–º–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞

[bold magenta]üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–µ—Å–µ—Ç—ã:[/]

[bold]1. üéô –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –¥–∏–∫—Ç–æ—Ä[/]
   ‚îú‚îÄ –î–ª—è: –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π, —Ä–µ–∫–ª–∞–º—ã, –∞–Ω–æ–Ω—Å–æ–≤
   ‚îú‚îÄ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏: —á—ë—Ç–∫–∞—è —Ä–µ—á—å, –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–Ω–æ–µ –∑–≤—É—á–∞–Ω–∏–µ
   ‚îî‚îÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∏: —Å—Ä–µ–¥–Ω–∏–π —Ç–µ–º–ø, –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –≥—Ä–æ–º–∫–æ—Å—Ç—å

[bold]2. üìö –ê—É–¥–∏–æ–∫–Ω–∏–≥–∞[/]
   ‚îú‚îÄ –î–ª—è: —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã
   ‚îú‚îÄ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏: –ø—Ä–∏—è—Ç–Ω—ã–π —Ç–µ–º–±—Ä, –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–∞—É–∑—ã
   ‚îî‚îÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∏: –∫–æ–º—Ñ–æ—Ä—Ç–Ω—ã–π —Ç–µ–º–ø, —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–≤—É–∫

[bold]3. üéì –û–±—É—á–∞—é—â–∏–π –º–∞—Ç–µ—Ä–∏–∞–ª[/]
   ‚îú‚îÄ –î–ª—è: —É—Ä–æ–∫–æ–≤, –ª–µ–∫—Ü–∏–π, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
   ‚îú‚îÄ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏: —á—ë—Ç–∫–æ–µ –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ
   ‚îî‚îÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∏: –º–µ–¥–ª–µ–Ω–Ω—ã–π —Ç–µ–º–ø, –ø–æ–≤—ã—à–µ–Ω–Ω–∞—è —á—ë—Ç–∫–æ—Å—Ç—å

[bold]4. üì∞ –ù–æ–≤–æ—Å—Ç–Ω–æ–π –¥–∏–∫—Ç–æ—Ä[/]
   ‚îú‚îÄ –î–ª—è: –Ω–æ–≤–æ—Å—Ç–µ–π, –æ–±–∑–æ—Ä–æ–≤, –æ—Ç—á—ë—Ç–æ–≤
   ‚îú‚îÄ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏: –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –∑–≤—É—á–∞–Ω–∏–µ
   ‚îî‚îÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∏: –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∏ —á—ë—Ç–∫–æ—Å—Ç—å

[bold]5. üó£ –†–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π —Å—Ç–∏–ª—å[/]
   ‚îú‚îÄ –î–ª—è: –¥–∏–∞–ª–æ–≥–æ–≤, –±–ª–æ–≥–æ–≤, –ø–æ–¥–∫–∞—Å—Ç–æ–≤
   ‚îú‚îÄ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏: –∂–∏–≤–∞—è —Ä–µ—á—å, –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–Ω—Ç–æ–Ω–∞—Ü–∏–∏
   ‚îî‚îÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∏: –¥–∏–Ω–∞–º–∏—á–Ω—ã–π —Ç–µ–º–ø, –∂–∏–≤–æ–µ –∑–≤—É—á–∞–Ω–∏–µ

[bold]6. üìñ –•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —á—Ç–µ–Ω–∏–µ[/]
   ‚îú‚îÄ –î–ª—è: –ø–æ—ç–∑–∏–∏, —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤
   ‚îú‚îÄ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏: –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ
   ‚îî‚îÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∏: —Ä–∞–∑–º–µ—Ä–µ–Ω–Ω—ã–π —Ç–µ–º–ø, —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

[bold yellow]üí° –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:[/]
1. –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –≤ —Ñ–∞–π–ª–µ text.txt
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –≥–æ–ª–æ—Å
3. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ—Å–µ—Ç –¥–ª—è –≤–∞—à–µ–π –∑–∞–¥–∞—á–∏
4. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

[bold red]‚ö†Ô∏è –í–∞–∂–Ω–æ:[/] –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª text.txt –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ç–æ–π –∂–µ –ø–∞–ø–∫–µ, —á—Ç–æ –∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞.
"""

# –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–µ—Å–µ—Ç–æ–≤
BASE_PRESETS = {
    "üéô –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –¥–∏–∫—Ç–æ—Ä": {
        "rate": "-3%",      # –°–ª–µ–≥–∫–∞ –∑–∞–º–µ–¥–ª–µ–Ω–Ω—ã–π —Ç–µ–º–ø –¥–ª—è —á–µ—Ç–∫–æ—Å—Ç–∏
        "volume": "+2%",    # –£–º–µ—Ä–µ–Ω–Ω–∞—è –≥—Ä–æ–º–∫–æ—Å—Ç—å –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∏—Å–∫–∞–∂–µ–Ω–∏–π
        "pitch": "-1Hz",    # –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–æ–Ω–∏–∂–µ–Ω–∏–µ —Ç–æ–Ω–∞ –¥–ª—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
    },
    "üìö –ê—É–¥–∏–æ–∫–Ω–∏–≥–∞": {
        "rate": "-5%",      # –ö–æ–º—Ñ–æ—Ä—Ç–Ω—ã–π —Ç–µ–º–ø –¥–ª—è –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è
        "volume": "+0%",    # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –≥—Ä–æ–º–∫–æ—Å—Ç—å
        "pitch": "+0Hz",    # –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–æ–Ω
    },
    "üéì –û–±—É—á–∞—é—â–∏–π –º–∞—Ç–µ—Ä–∏–∞–ª": {
        "rate": "-10%",     # –ú–µ–¥–ª–µ–Ω–Ω—ã–π —Ç–µ–º–ø –¥–ª—è –ª—É—á—à–µ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è
        "volume": "+3%",    # –°–ª–µ–≥–∫–∞ –ø–æ–≤—ã—à–µ–Ω–Ω–∞—è –≥—Ä–æ–º–∫–æ—Å—Ç—å –¥–ª—è —á–µ—Ç–∫–æ—Å—Ç–∏
        "pitch": "-2Hz",    # –õ–µ–≥–∫–æ–µ –ø–æ–Ω–∏–∂–µ–Ω–∏–µ –¥–ª—è –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–Ω–æ—Å—Ç–∏
    },
    "üì∞ –ù–æ–≤–æ—Å—Ç–Ω–æ–π –¥–∏–∫—Ç–æ—Ä": {
        "rate": "+0%",      # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ç–µ–º–ø
        "volume": "+4%",    # –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –≥—Ä–æ–º–∫–æ—Å—Ç—å –¥–ª—è –Ω–æ–≤–æ—Å—Ç–µ–π
        "pitch": "-2Hz",    # –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –∑–≤—É—á–∞–Ω–∏–µ
    },
    "üó£ –†–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π —Å—Ç–∏–ª—å": {
        "rate": "+2%",      # –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–µ–º–ø —Ä–µ—á–∏
        "volume": "+1%",    # –õ–µ–≥–∫–æ–µ —É—Å–∏–ª–µ–Ω–∏–µ –¥–ª—è —á–µ—Ç–∫–æ—Å—Ç–∏
        "pitch": "+0Hz",    # –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–æ–Ω
    },
    "üìñ –•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —á—Ç–µ–Ω–∏–µ": {
        "rate": "-7%",      # –†–∞–∑–º–µ—Ä–µ–Ω–Ω—ã–π —Ç–µ–º–ø –¥–ª—è –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        "volume": "+2%",    # –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –≥—Ä–æ–º–∫–æ—Å—Ç—å
        "pitch": "-1Hz",    # –õ–µ–≥–∫–æ–µ –ø–æ–Ω–∏–∂–µ–Ω–∏–µ –¥–ª—è –≥–ª—É–±–∏–Ω—ã
    }
}

# –ì–æ–ª–æ—Å–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª–æ–≤
VOICES = {
    "–ú—É–∂—Å–∫–æ–π": "ru-RU-DmitryNeural",
    "–ñ–µ–Ω—Å–∫–∏–π": "ru-RU-SvetlanaNeural"
}

def get_preset_settings(preset_name: str, voice: str) -> Dict:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–µ—Å–µ—Ç–∞ —Å —É—á–µ—Ç–æ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≥–æ–ª–æ—Å–∞"""
    settings = BASE_PRESETS[preset_name].copy()
    settings["voice"] = voice
    return settings

async def show_help():
    """–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É –æ –ø—Ä–æ–≥—Ä–∞–º–º–µ"""
    # –û—á–∏—â–∞–µ–º —ç–∫—Ä–∞–Ω –ø–µ—Ä–µ–¥ –≤—ã–≤–æ–¥–æ–º —Å–ø—Ä–∞–≤–∫–∏
    console.clear()
    
    # –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    console.print(Panel.fit(
        f"[bold cyan]{PROGRAM_NAME}[/] - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ä–µ—á–∏",
        border_style="cyan",
        padding=(1, 2)
    ))

    console.print()  # –û—Ç—Å—Ç—É–ø

    # –û –ø—Ä–æ–≥—Ä–∞–º–º–µ –∏ –∫–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ
    left_panel = Panel.fit(
        "[bold yellow]–û –ø—Ä–æ–≥—Ä–∞–º–º–µ[/]\n\n" +
        "–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–π —Ä–µ—á–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ\n" +
        "–Ω–µ–π—Ä–æ—Å–µ—Ç–µ–π Microsoft Edge TTS. –ò–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è\n" +
        "–∞—É–¥–∏–æ–∫–Ω–∏–≥, –ø–æ–¥–∫–∞—Å—Ç–æ–≤, –æ–±—É—á–∞—é—â–∏—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏ –º–Ω–æ–≥–æ–≥–æ –¥—Ä—É–≥–æ–≥–æ.",
        border_style="yellow",
        width=50,
        padding=(1, 2)
    )

    right_panel = Panel.fit(
        "‚Ä¢ –í—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏\n" +
        "‚Ä¢ –î–≤–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –≥–æ–ª–æ—Å–∞\n" +
        "‚Ä¢ –ì–æ—Ç–æ–≤—ã–µ –ø—Ä–µ—Å–µ—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á\n" +
        "‚Ä¢ –¢–æ—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤\n" +
        "‚Ä¢ –£–º–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞",
        title="[bold green]üåü –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏[/]",
        border_style="green",
        width=50,
        padding=(1, 2)
    )

    # –í—ã–≤–æ–¥–∏–º –ø–∞–Ω–µ–ª–∏ –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É
    console.print(Columns([left_panel, right_panel]))
    
    console.print()  # –û—Ç—Å—Ç—É–ø

    # –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –ø—Ä–µ—Å–µ—Ç–æ–≤
    table = Table(
        show_header=True,
        header_style="bold magenta",
        border_style="magenta",
        title="[bold magenta]üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–µ—Å–µ—Ç—ã[/]",
        padding=(0, 1),
        expand=True,
        show_lines=True,
        box=SQUARE,
        row_styles=["none", "dim"]
    )
    
    table.add_column("–ü—Ä–µ—Å–µ—Ç", style="cyan", no_wrap=True, justify="left")
    table.add_column("–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ", style="green", justify="left")
    table.add_column("–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏", style="yellow", justify="left")
    table.add_column("–ù–∞—Å—Ç—Ä–æ–π–∫–∏", style="blue", justify="left")

    # –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü—É —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
    table.add_row(
        "üéô –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π\n   –¥–∏–∫—Ç–æ—Ä",
        "–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏, —Ä–µ–∫–ª–∞–º–∞,\n–∞–Ω–æ–Ω—Å—ã",
        "–ß—ë—Ç–∫–∞—è —Ä–µ—á—å,\n–∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–Ω–æ–µ –∑–≤—É—á–∞–Ω–∏–µ",
        "–°—Ä–µ–¥–Ω–∏–π —Ç–µ–º–ø,\n–æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –≥—Ä–æ–º–∫–æ—Å—Ç—å"
    )
    table.add_row(
        "üìö –ê—É–¥–∏–æ–∫–Ω–∏–≥–∞",
        "–•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è\n–ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞",
        "–ü—Ä–∏—è—Ç–Ω—ã–π —Ç–µ–º–±—Ä,\n–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–∞—É–∑—ã",
        "–ö–æ–º—Ñ–æ—Ä—Ç–Ω—ã–π —Ç–µ–º–ø,\n—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–≤—É–∫"
    )
    table.add_row(
        "üéì –û–±—É—á–∞—é—â–∏–π\n   –º–∞—Ç–µ—Ä–∏–∞–ª",
        "–£—Ä–æ–∫–∏, –ª–µ–∫—Ü–∏–∏,\n–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏",
        "–ß—ë—Ç–∫–æ–µ\n–ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ",
        "–ú–µ–¥–ª–µ–Ω–Ω—ã–π —Ç–µ–º–ø,\n–ø–æ–≤—ã—à–µ–Ω–Ω–∞—è —á—ë—Ç–∫–æ—Å—Ç—å"
    )
    table.add_row(
        "üì∞ –ù–æ–≤–æ—Å—Ç–Ω–æ–π\n   –¥–∏–∫—Ç–æ—Ä",
        "–ù–æ–≤–æ—Å—Ç–∏, –æ–±–∑–æ—Ä—ã,\n–æ—Ç—á—ë—Ç—ã",
        "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ\n–∑–≤—É—á–∞–Ω–∏–µ",
        "–û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å\n–∏ —á—ë—Ç–∫–æ—Å—Ç—å"
    )
    table.add_row(
        "üó£ –†–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π\n   —Å—Ç–∏–ª—å",
        "–î–∏–∞–ª–æ–≥–∏, –±–ª–æ–≥–∏,\n–ø–æ–¥–∫–∞—Å—Ç—ã",
        "–ñ–∏–≤–∞—è —Ä–µ—á—å,\n–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–Ω—Ç–æ–Ω–∞—Ü–∏–∏",
        "–î–∏–Ω–∞–º–∏—á–Ω—ã–π —Ç–µ–º–ø,\n–∂–∏–≤–æ–µ –∑–≤—É—á–∞–Ω–∏–µ"
    )
    table.add_row(
        "üìñ –•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ\n   —á—Ç–µ–Ω–∏–µ",
        "–ü–æ—ç–∑–∏—è,\n—Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã",
        "–í—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ–µ\n—á—Ç–µ–Ω–∏–µ",
        "–†–∞–∑–º–µ—Ä–µ–Ω–Ω—ã–π —Ç–µ–º–ø,\n—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å"
    )

    console.print(table)
    
    console.print()  # –û—Ç—Å—Ç—É–ø

    # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∏ –≤–∞–∂–Ω–æ–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ
    left_panel = Panel.fit(
        "1. –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –≤ —Ñ–∞–π–ª–µ text.txt\n" +
        "2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª text.txt –Ω–∞—Ö–æ–¥–∏—Ç—Å—è\n" +
        "–≤ —Ç–æ–π –∂–µ –ø–∞–ø–∫–µ, —á—Ç–æ –∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞.\n" +
        "3. –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –≥–æ–ª–æ—Å\n" +
        "4. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ—Å–µ—Ç –¥–ª—è –≤–∞—à–µ–π –∑–∞–¥–∞—á–∏\n" +
        "5. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏",
        title="[bold yellow]üí° –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å[/]",
        border_style="yellow",
        width=50,
        padding=(1, 2),
        box=SQUARE
    )
    
    # –í—ã–≤–æ–¥–∏–º –ø–∞–Ω–µ–ª—å —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏
    console.print(left_panel)
    
    console.print()  # –û—Ç—Å—Ç—É–ø

    # –û–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞
    await questionary.text(
        "–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...",
        style=questionary.Style([
            ('question', 'fg:teal'),
            ('pointer', 'fg:teal bold')
        ])
    ).ask_async()

async def text_to_speech():
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
    console.print(Panel.fit(
        f"[bold blue]{PROGRAM_NAME} v{PROGRAM_VERSION}[/]\n" +
        "[cyan]–ù–µ–π—Ä–æ–Ω–Ω—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ä–µ—á–∏ —Å –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏[/]",
        border_style="blue"
    ))
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é
    action = await questionary.select(
        "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
        choices=[
            "üéô –ù–∞—á–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é",
            "‚ùî –°–ø—Ä–∞–≤–∫–∞",
            "‚ùå –í—ã—Ö–æ–¥"
        ],
        style=questionary.Style([
            ('answer', 'fg:teal'),
            ('selected', 'fg:teal bg:gray'),
            ('pointer', 'fg:teal bold'),
            ('highlighted', 'fg:teal')
        ])
    ).ask_async()
    
    if action == "‚ùå –í—ã—Ö–æ–¥":
        return
    elif action == "‚ùî –°–ø—Ä–∞–≤–∫–∞":
        await show_help()
        await text_to_speech()
        return
    
    # –í—ã–±–æ—Ä –ø–æ–ª–∞ –¥–∏–∫—Ç–æ—Ä–∞
    gender = await questionary.select(
        "–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ–ª–æ—Å –¥–∏–∫—Ç–æ—Ä–∞:",
        choices=list(VOICES.keys()),
        style=questionary.Style([
            ('answer', 'fg:blue'),
            ('selected', 'fg:blue bg:gray'),
            ('pointer', 'fg:blue bold'),
            ('highlighted', 'fg:blue')
        ])
    ).ask_async()
    
    # –í—ã–±–æ—Ä –ø—Ä–µ—Å–µ—Ç–∞
    preset_name = await questionary.select(
        "–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∏–ª—å —Ä–µ—á–∏:",
        choices=list(BASE_PRESETS.keys()),
        style=questionary.Style([
            ('answer', 'fg:teal'),
            ('selected', 'fg:teal bg:gray'),
            ('pointer', 'fg:teal bold'),
            ('highlighted', 'fg:teal')
        ])
    ).ask_async()
    
    # –ü–æ–ª—É—á–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å —É—á–µ—Ç–æ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≥–æ–ª–æ—Å–∞
    settings = get_preset_settings(preset_name, VOICES[gender])
    
    # –ß—Ç–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ —Ñ–∞–π–ª–∞
    try:
        with open('text.txt', 'r', encoding='utf-8') as file:
            text = file.read()
            
        # –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞
        text = text.replace('...', '‚Ä¶ ').replace('..', '‚Ä¶')
        text = text.replace('!?', '?!').replace('?.', '?')
        text = text.strip()
        
        if not text:
            raise ValueError("–§–∞–π–ª text.txt –ø—É—Å—Ç!")
            
    except FileNotFoundError:
        console.print("[red]–û—à–∏–±–∫–∞: –§–∞–π–ª text.txt –Ω–µ –Ω–∞–π–¥–µ–Ω![/]")
        return
    except Exception as e:
        console.print(f"[red]–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞: {str(e)}[/]")
        return
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ –¥–ª—è —Å–∏–Ω—Ç–µ–∑–∞ —Ä–µ—á–∏ —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
    tts = edge_tts.Communicate(
        text=text,
        **settings
    )
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
    with Progress(
        SpinnerColumn(),
        TextColumn("[progress.description]{task.description}"),
        BarColumn(complete_style="green", finished_style="green"),
        TextColumn("[progress.percentage]{task.percentage:>3.0f}%"),
        TimeRemainingColumn(),
    ) as progress:
        # –°–æ–∑–¥–∞–µ–º –∑–∞–¥–∞—á—É –¥–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
        task = progress.add_task("[cyan]–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—á–∏...", total=100)
        
        try:
            # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞—É–¥–∏–æ —Ñ–∞–π–ª–∞
            output_file = "output_speech.mp3"
            
            # –ó–∞–ø—É—Å–∫–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
            async def update_progress():
                current = 0
                while current < 95:
                    await asyncio.sleep(0.1)
                    current += 1
                    progress.update(task, completed=current)
            
            # –ó–∞–ø—É—Å–∫–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
            await asyncio.gather(
                tts.save(output_file),
                update_progress()
            )
            
            # –ó–∞–≤–µ—Ä—à–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            progress.update(task, completed=100)
            
        except Exception as e:
            console.print(f"[red]–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∞—É–¥–∏–æ: {str(e)}[/]")
            return
    
    # –í—ã–≤–æ–¥–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
    console.print(Panel.fit(
        f"[bold green]‚ú® –ê—É–¥–∏–æ —Ñ–∞–π–ª —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω: {output_file}[/]\n\n"
        f"[cyan]–ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:[/]\n"
        f"- –ì–æ–ª–æ—Å: {gender}\n"
        f"- –°—Ç–∏–ª—å: {preset_name}\n"
        f"- –°–∫–æ—Ä–æ—Å—Ç—å —Ä–µ—á–∏: {settings['rate']}\n"
        f"- –£—Ä–æ–≤–µ–Ω—å –≥—Ä–æ–º–∫–æ—Å—Ç–∏: {settings['volume']}\n"
        f"- –¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å: {settings['pitch']}",
        title="üéâ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ üéâ",
        border_style="green"
    ))

if __name__ == '__main__':
    try:
        asyncio.run(text_to_speech())
    except KeyboardInterrupt:
        console.print("\n[red]‚ùå –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–µ—Ä–≤–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º[/]")
    except Exception as e:
        console.print(f"\n[red]‚ùå –û—à–∏–±–∫–∞: {str(e)}[/]") 